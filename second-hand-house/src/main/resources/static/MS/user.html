<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Insert title here</title>
<script type="text/javascript" src="../MS/lib/jquery/1.9.1/jquery.min.js"></script>
<!-- 以下是方法二所需要引入的js -->
<link type="text/css" href="../MS/lib/layui-v2.0.2/css/layui.css" rel="stylesheet">
	<link rel="stylesheet" href="../MS/plugins/layui/css/layui.css" media="all" />
	<link rel="stylesheet" href="../MS/css/global.css" media="all">
	<link rel="stylesheet" href="../MS/plugins/font-awesome/css/font-awesome.min.css">
	<script type="text/javascript" src="../MS/lib/layui-v2.0.2/layui.all.js"></script>
	<script type="text/javascript" src="../MS/js/BaseValues.js"></script>

</head>
<body>
	<fieldset class="layui-elem-field">
		<legend>会员管理</legend>
		<div>
			<form>
				<div class="layui-form-item">
					<div class="layui-form-item">
					    <div class="layui-inline">
							<label class="layui-form-label">用户名</label>
							<div class="layui-input-block">
								<input type="text" name="userName" lay-verify="title" autocomplete="off" placeholder="用户名" class="layui-input"/>
							</div>
						</div>
						<div class="layui-inline">
							<label class="layui-form-label">联系方式</label>
							<div class="layui-input-block">
								<input type="text" name="contactWay" lay-verify="phone" autocomplete="off" placeholder="联系方式" class="layui-input"/>
							</div>
						</div>
						<div class="layui-inline">
							<label class="layui-form-label">身份证号</label>
							<div class="layui-input-block">
								<input type="text" name="certNo" lay-verify="identity" autocomplete="off" placeholder="身份证号" class="layui-input"/>
							</div>
						</div>
						<div class="layui-inline">
							<label class="layui-form-label">性别</label>
							<div class="layui-input-block">
								<select name="sex" lay-filter="sex">
									<option value=""></option>
									<option value="女">女</option>
									<option value="男">男</option>
								</select>
							</div>
						</div>
					</div>
					<div class="layui-form-item">
						<div class="layui-inline">
							<label class="layui-form-label">积分数量</label>
							<div class="layui-input-inline" style="width: 100px;">
								<input type="text" name="integralNumBegin" placeholder="" autocomplete="off" class="layui-input"/>
							</div>
							<div class="layui-form-mid">-</div>
							<div class="layui-input-inline" style="width: 100px;">
								<input type="text" name="integralNumEnd" placeholder="" autocomplete="off" class="layui-input"/>
							</div>
						</div>
						<div class="layui-inline">
							<label class="layui-form-label">账号</label>
							<div class="layui-input-block">
								<input type="text" name="account" lay-verify="title" autocomplete="off" placeholder="账号" class="layui-input"/>
							</div>
						</div>
						<button class="layui-btn" id="search">搜索</button>
					</div>
				</div>
			</form>
			<table class="site-table table-hover">
				<thead>
				<tr>
					<th>姓名</th>
					<th>账号</th>
					<th>电话</th>
					<th>身份证号</th>
					<th>性别</th>
					<th>生日</th>
					<th>积分数量</th>
					<th>创建时间</th>
					<th>操作</th>
				</tr>
				</thead>
				<!--内容容器-->
				<tbody id="tbody">
				</tbody>
			</table>
			<!--分页容器-->
			<div id="page"></div>
		</div>

	</fieldset>

</body>
<script type="text/javascript">

//方法二则直接使用layui-v2.0.2里面的分页功能，没有用到core.js里面的方法
layui.use('laypage', function(){
  var laypage = layui.laypage;
  var url = basePath+"user/page";
  // 封装参数
  var config = {page:1,pageSize:5};
  $.getJSON(url,config,function(res){
	  laypage.render({
		    elem: 'page',
		    count: res.total, //总条数
		    limit:config.pageSize, //每页条数
		    //theme: '#FFB800', //自定义颜色
		    jump: function(obj, first){
		        if(!first){ //首次则不进入
		        	config.page = obj.curr;
		        	getUserListByPage(url,config);
		        }
		    }
	   });
	  parseUserList(res,config.page);  
  }); 
});
//点击页数从后台获取数据
function getUserListByPage(url,config){
	$.getJSON(url,config,function(res){
		parseUserList(res,config.page);
	});
}

//解析数据，currPage参数为预留参数，当删除一行刷新列表时，可以记住当前页而不至于显示到首页去
function parseUserList(res,currPage){
	var content = "";
	$.each(res.rows, function (i, o) {
		content += "<tr>";
		content += "<td>"+o.userName+"</td>";
		content += "<td>"+o.account+"</td>";
		content += "<td>"+o.contactWay+"</td>";
		content += "<td>"+o.certNo+"</td>";
		content += "<td>"+o.sex+"</td>";
		content += "<td>"+formatDate(o.birth)+"</td>";
        content += "<td>"+o.integralNum+"</td>";
        content += "<td>"+formatDate(o.createTime)+"</td>";
		content += "<td>" +
						'<a href="/detail-1" target="_blank" class="layui-btn layui-btn-normal layui-btn-mini">查看</a>&nbsp;&nbsp;' +
						'<a href="/manage/article_edit_1" class="layui-btn layui-btn-mini">编辑</a>&nbsp;&nbsp;' +
						'<a href="javascript:;" data-id="1" data-opt="del" class="layui-btn layui-btn-danger layui-btn-mini">重置密码</a>&nbsp;&nbsp;' +
						'<a href="javascript:;" data-id="1" data-opt="del" class="layui-btn layui-btn-danger layui-btn-mini">调整积分</a>' +
					"</td>";
		content += "</tr>";
	});
	$('#tbody').html(content);
}
function formatDate(timestamp) {
	var date = new Date(timestamp);
	Y = date.getFullYear() + '-';
	M = (date.getMonth()+1 < 10 ? '0'+(date.getMonth()+1) : date.getMonth()+1) + '-';
	D = date.getDate() + ' ';
	return Y+M+D;
}
</script>
</html>